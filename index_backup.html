<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terry Dynamics - AI Infrastructure</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            scroll-behavior: smooth;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid #3b82f6; /* Using blue-500 color */
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-indicator.warning {
            background-color: #f59e0b;
            animation: pulse-warning 2s infinite;
        }

        @keyframes pulse-warning {
            0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
        }

        .status-indicator.danger {
            background-color: #ef4444;
            animation: pulse-danger 2s infinite;
        }

        @keyframes pulse-danger {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .card-gradient {
            background: linear-gradient(180deg, rgba(30, 41, 59, 0.5) 0%, rgba(15, 23, 42, 0.5) 100%);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-card {
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #10b981;
            box-shadow: 0 0 10px #10b981;
            margin-right: 6px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .btn-primary {
            background: linear-gradient(90deg, #3b82f6 0%, #38bdf8 100%);
            box-shadow: 0 4px 14px rgba(59, 130, 246, 0.4);
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.8);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 3px;
        }

        .terminal-output {
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .chart-container {
            position: relative;
            height: 200px;
        }

        /* Responsive text adjustments */
        .text-responsive {
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .text-responsive {
                font-size: 13px;
            }
            .chart-container {
                height: 160px;
            }
        }
    </style>
</head>
<body class="text-gray-300 min-h-screen">
    <!-- Navbar -->
    <nav class="fixed w-full bg-opacity-80 bg-gray-900 backdrop-filter backdrop-blur-lg border-b border-gray-800 z-50">
        <div class="container mx-auto px-4 py-2">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <a href="#" class="text-xl font-bold text-white">
                        <span class="text-blue-400">Terry</span><span class="text-cyan-400">Dynamics</span>
                    </a>
                    <span class="ml-2 px-2 py-1 bg-blue-900 bg-opacity-30 rounded text-blue-300 text-xs font-medium">AI LAB</span>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="hidden md:flex items-center text-xs">
                        <div class="status-indicator"></div>
                        <span class="text-green-400">ONLINE</span>
                    </div>
                    <a href="https://api.terrydynamics.com:8080" target="_blank" class="btn-primary px-3 py-1.5 rounded-lg text-white font-medium text-sm">
                        Launch AI Lab
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-16 pb-6">
        <div class="container mx-auto px-4">
            <!-- Hero Section -->
            <div class="mb-8 text-center">
                <h1 class="text-2xl md:text-3xl font-bold text-white mb-2">Local AI Infrastructure</h1>
                <p class="text-gray-400 text-sm md:text-base max-w-2xl mx-auto">Running high-performance AI directly on dedicated hardware, no cloud required</p> <!-- Updated subtitle slightly -->
            </div>

            <!-- System Status Cards -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
                <!-- CPU Card -->
                <div class="stat-card bg-gray-800 border border-gray-700 rounded-lg p-3">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-gray-400 text-xs">CPU</h3>
                        <div class="bg-blue-500 bg-opacity-10 p-1.5 rounded">
                            <i class="fas fa-microchip text-blue-500"></i>
                        </div>
                    </div>
                    <p class="text-white text-lg font-bold" id="cpu-usage">--%</p>
                    <div class="w-full bg-gray-700 rounded-full h-1.5 mt-1.5">
                        <div id="cpu-bar" class="bg-blue-500 h-1.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Memory Card -->
                <div class="stat-card bg-gray-800 border border-gray-700 rounded-lg p-3">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-gray-400 text-xs">MEMORY</h3>
                        <div class="bg-green-500 bg-opacity-10 p-1.5 rounded">
                            <i class="fas fa-memory text-green-500"></i>
                        </div>
                    </div>
                    <p class="text-white text-lg font-bold" id="memory-usage">--%</p>
                    <div class="w-full bg-gray-700 rounded-full h-1.5 mt-1.5">
                        <div id="memory-bar" class="bg-green-500 h-1.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>

                <!-- GPU Card -->
                <div class="stat-card bg-gray-800 border border-gray-700 rounded-lg p-3">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-gray-400 text-xs">GPU</h3>
                        <div class="bg-purple-500 bg-opacity-10 p-1.5 rounded">
                            <i class="fas fa-gamepad text-purple-500"></i>
                        </div>
                    </div>
                    <p class="text-white text-lg font-bold" id="gpu-usage">--%</p>
                    <div class="w-full bg-gray-700 rounded-full h-1.5 mt-1.5">
                        <div id="gpu-bar" class="bg-purple-500 h-1.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>

                <!-- VRAM Card -->
                <div class="stat-card bg-gray-800 border border-gray-700 rounded-lg p-3">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-gray-400 text-xs">VRAM</h3>
                        <div class="bg-pink-500 bg-opacity-10 p-1.5 rounded">
                            <i class="fas fa-database text-pink-500"></i>
                        </div>
                    </div>
                    <p class="text-white text-lg font-bold" id="vram-usage">--%</p>
                    <div class="w-full bg-gray-700 rounded-full h-1.5 mt-1.5">
                        <div id="vram-bar" class="bg-pink-500 h-1.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Main Dashboard -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                <!-- Terminal Demo -->
                <div class="lg:col-span-2 bg-gray-800 border border-gray-700 rounded-lg overflow-hidden">
                    <div class="flex items-center justify-between border-b border-gray-700 px-3 py-2">
                        <h3 class="text-white text-sm font-medium flex items-center">
                            <i class="fas fa-terminal text-blue-400 mr-2"></i>
                            AI System Demo
                        </h3>
                        <span class="text-xs text-gray-400" id="last-updated">Updated: --:--:--</span>
                    </div>
                    <div class="p-3">
                        <div class="bg-gray-900 rounded p-3 h-48 md:h-56 overflow-y-auto terminal-output" id="terminal-text">
                            <!-- Terminal output populated by JavaScript -->
                        </div>
                        <!-- REMOVED ComfyUI Prompt Input Section -->
                        <div class="mt-2 flex items-center justify-between text-xs">
                            <div class="flex items-center">
                                <span class="text-gray-400">Model:</span>
                                <span class="ml-2 px-2 py-0.5 bg-purple-900 bg-opacity-30 rounded text-purple-300">Gemma3-12B (Q4_K_M)</span>
                            </div>
                            <div class="text-gray-400">
                                <i class="fas fa-thermometer-half text-yellow-400 mr-1"></i>
                                <span id="gpu-temp">--°F</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hardware & Quick Actions -->
                <div class="bg-gray-800 border border-gray-700 rounded-lg overflow-hidden">
                    <div class="border-b border-gray-700 px-3 py-2">
                        <h3 class="text-white text-sm font-medium flex items-center">
                            <i class="fas fa-server text-green-400 mr-2"></i>
                            System Info
                        </h3>
                    </div>
                    <div class="p-3">
                        <div class="space-y-2 text-xs">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Hardware:</span>
                                <span class="text-white">NVIDIA P40, 64GB RAM</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Storage:</span>
                                <span class="text-white" id="disk-usage">--% of 2TB SSD</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Platform:</span>
                                <span class="text-white">Arch Linux, Ollama</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Uptime:</span>
                                <span class="text-white" id="system-uptime">--:--:--</span>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h4 class="text-xs font-medium text-gray-400 mb-2">Quick Actions</h4>
                            <div class="grid grid-cols-3 gap-2">
                                <a href="https://api.terrydynamics.com:8080" target="_blank" class="flex items-center justify-center p-2 bg-blue-600 bg-opacity-20 border border-blue-600 rounded hover:bg-opacity-30 transition-colors">
                                    <i class="fas fa-robot text-blue-400 mr-2"></i>
                                    <span class="text-white text-xs">AI Chat</span>
                                </a>
                                <a href="https://api.terrydynamics.com/comfyui/" target="_blank" class="flex items-center justify-center p-2 bg-pink-600 bg-opacity-20 border border-pink-600 rounded hover:bg-opacity-30 transition-colors">
                                    <i class="fas fa-image text-pink-400 mr-2"></i>
                                    <span class="text-white text-xs">Images</span>
                                </a>
                                <a href="https://ollama.ai/" target="_blank" class="flex items-center justify-center p-2 bg-purple-600 bg-opacity-20 border border-purple-600 rounded hover:bg-opacity-30 transition-colors">
                                    <i class="fas fa-cube text-purple-400 mr-2"></i>
                                    <span class="text-white text-xs">Ollama</span>
                                </a>
                            </div>
                        </div>

                        <div class="mt-4 p-2 bg-green-900 bg-opacity-20 rounded border border-green-700 text-xs">
                            <div class="text-green-400 font-medium mb-1">P40 GPU Installed!</div>
                            <p class="text-gray-300">24GB VRAM now available for larger models</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Status card -->
            <div class="mt-4 bg-gray-800 border border-gray-700 rounded-lg overflow-hidden">
                <div class="border-b border-gray-700 px-3 py-2">
                    <h3 class="text-white text-sm font-medium flex items-center">
                        <i class="fas fa-brain text-purple-400 mr-2"></i>
                        Model Status
                    </h3>
                </div>
                <div class="p-3" id="model-status-display">
                    <!-- This is where the model status will be displayed -->
                </div>
            </div>

            <!-- Project News Section Added -->
            <div class="mt-6 bg-gray-800 border border-gray-700 rounded-lg overflow-hidden">
                <div class="border-b border-gray-700 px-3 py-2">
                    <h3 class="text-white text-sm font-medium flex items-center">
                        <i class="fas fa-newspaper text-cyan-400 mr-2"></i>
                        Project Avocado News
                    </h3>
                </div>
                <div class="p-4">
                    <h4 class="text-lg font-semibold text-white mb-2">Month 1 Milestone Reached!</h4>
                    <p class="text-sm text-gray-300 mb-4">
                        Over the past month, we built 'Project Avocado' - an AI development platform on dedicated hardware. We went from a bare server to integrating multiple large language models (like Mistral and Google's Gemma 3), built custom APIs, a live system monitoring dashboard, a feature-rich Discord bot, and laid the groundwork for an advanced AI agent framework. We overcame significant technical hurdles and upgraded our hardware (NVIDIA P40 GPU) to dramatically increase capability. The platform is now ready for the next phase of agent development!
                    </p>
                    <a href="progress-month-1.html" class="inline-block btn-primary px-4 py-2 rounded-lg text-white font-medium text-sm">
                        Read Full Month 1 Progress Report
                    </a>
                </div>
            </div>
            <!-- End Project News Section -->

            <!-- Performance Charts -->
            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- System Performance -->
                <div class="bg-gray-800 border border-gray-700 rounded-lg overflow-hidden">
                    <div class="border-b border-gray-700 px-3 py-2">
                        <h3 class="text-white text-sm font-medium flex items-center">
                            <i class="fas fa-chart-line text-blue-400 mr-2"></i>
                            System Performance
                        </h3>
                    </div>

                    <div class="p-3">
                        <div class="chart-container">
                            <canvas id="performance-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- GPU Memory Usage -->
                <div class="bg-gray-800 border border-gray-700 rounded-lg overflow-hidden">
                    <div class="border-b border-gray-700 px-3 py-2">
                        <h3 class="text-white text-sm font-medium flex items-center">
                            <i class="fas fa-memory text-pink-400 mr-2"></i>
                            GPU Memory Usage
                        </h3>
                    </div>
                    <div class="p-3">
                        <div class="chart-container">
                            <canvas id="gpu-memory-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-800 py-4">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center text-xs">
                <div class="mb-2 md:mb-0">
                    <p class="text-white font-medium">
                        <span class="text-blue-400">Terry</span><span class="text-cyan-400">Dynamics</span>
                    </p>
                </div>
                <div>
                    <p class="text-gray-500">© 2025 Terry Dynamics • AI Infrastructure Solutions</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // Convert Celsius to Fahrenheit
        function celsiusToFahrenheit(celsius) {
            return (celsius * 9/5) + 32;
        }

        // Terminal animation
        const terminalText = document.getElementById('terminal-text');
        const terminalLines = [
            '<span class="text-green-400">→ Initializing AI system...</span>',
            '<span class="text-blue-400">→ Loading Gemma3-12B model...</span>',
            '<span class="text-green-400">→ Model loaded successfully</span>',
            '<span class="text-yellow-400">→ VRAM allocation: 5.2GB/24GB</span>',
            '<span class="text-blue-400">→ CUDA optimizations enabled</span>',
            '<span class="text-green-400">→ System ready for inference</span>',
            '$ <span class="text-white">ask "What can you help me with today?"</span>',
            '<span class="text-cyan-400">I can assist with various tasks including:</span>',
            '<span class="text-cyan-400">- Answering questions and providing information</span>',
            '<span class="text-cyan-400">- Writing and editing content</span>',
            '<span class="text-cyan-400">- Coding assistance and debugging</span>',
            '<span class="text-cyan-400">- Creative writing and brainstorming</span>',
            '<span class="text-cyan-400">Just ask your question, and I\'ll do my best to help!</span>'
        ];

        let lineIndex = 0;
        function typeTerminalLine() {
            if (lineIndex < terminalLines.length) {
                terminalText.innerHTML += terminalLines[lineIndex] + '<br>';
                terminalText.scrollTop = terminalText.scrollHeight;
                lineIndex++;
                setTimeout(typeTerminalLine, 500);
            }
        }

        // Start typing after a short delay
        setTimeout(typeTerminalLine, 1000);

        // Charts
        let performanceChart = null;
        let gpuMemoryChart = null;

        // Initialize charts
        function initCharts() {
            // Set Chart.js defaults
            Chart.defaults.color = '#9ca3af';
            Chart.defaults.borderColor = 'rgba(75, 85, 99, 0.2)';
            Chart.defaults.font.size = 10;

            // Performance Chart
            const performanceCtx = document.getElementById('performance-chart').getContext('2d');
            performanceChart = new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: Array(30).fill(''),
                    datasets: [
                        {
                            label: 'CPU',
                            data: Array(30).fill(0),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            borderWidth: 2
                        },
                        {
                            label: 'GPU',
                            data: Array(30).fill(0),
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            tension: 0.4,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuad'
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                boxWidth: 12,
                                padding: 10
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 8,
                                callback: function(value, index, values) {
                                    // Show more meaningful time labels
                                    if (index % 4 === 0) return this.getLabelForValue(index);
                                    return '';
                                }
                            }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            ticks: {
                                callback: value => `${value}%`
                            }
                        }
                    }
                }
            });

            // GPU Memory Chart
            const gpuMemoryCtx = document.getElementById('gpu-memory-chart').getContext('2d');
            gpuMemoryChart = new Chart(gpuMemoryCtx, {
                type: 'line',
                data: {
                    labels: Array(30).fill(''),
                    datasets: [{
                        label: 'VRAM',
                        data: Array(30).fill(0),
                        borderColor: '#ec4899',
                        backgroundColor: 'rgba(236, 72, 153, 0.2)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuad'
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                boxWidth: 12,
                                padding: 10
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.raw.toFixed(0)} MB`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 8,
                                callback: function(value, index, values) {
                                    // Show more meaningful time labels
                                    if (index % 4 === 0) return this.getLabelForValue(index);
                                    return '';
                                }
                            }
                        },
                        y: {
                            ticks: {
                                callback: value => `${value} MB`
                            }
                        }
                    }
                }
            });
        }

        // Fetch and update system data
        async function fetchSystemData() {
            try {
                console.log("Fetching system data...");
                // Use the Gemma3 API health endpoint for the most up-to-date info
                const response = await fetch('https://api.terrydynamics.com/gemma/api/health', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) throw new Error(`HTTP Error ${response.status}`);

                const data = await response.json();
                console.log("Fetched Data:", data);

                // Update timestamp
                const now = new Date();
                document.getElementById('last-updated').textContent = `Updated: ${now.toLocaleTimeString()}`;

                // Update system info
                document.getElementById('system-uptime').textContent = data.system.uptime;

                // Update CPU stats
                document.getElementById('cpu-usage').textContent = `${data.system.cpu_percent.toFixed(1)}%`;
                document.getElementById('cpu-bar').style.width = `${data.system.cpu_percent}%`;

                // Update memory stats
                document.getElementById('memory-usage').textContent = `${data.system.memory_percent.toFixed(1)}%`;
                document.getElementById('memory-bar').style.width = `${data.system.memory_percent}%`;

                // Update GPU stats
                document.getElementById('gpu-usage').textContent = `${data.gpu.gpu_load.toFixed(1)}%`;
                // Convert Celsius to Fahrenheit for temperature
                const tempF = celsiusToFahrenheit(data.gpu.gpu_temperature);
                document.getElementById('gpu-temp').textContent = `${tempF.toFixed(1)}°F`;
                document.getElementById('gpu-bar').style.width = `${data.gpu.gpu_load}%`;

                // Update VRAM stats
                const vramPercent = data.gpu.gpu_memory_used_percent;
                document.getElementById('vram-usage').textContent = `${vramPercent.toFixed(1)}%`;
                document.getElementById('vram-bar').style.width = `${vramPercent}%`;

                // Update disk usage
                document.getElementById('disk-usage').textContent = `${data.system.disk_percent.toFixed(1)}% of ${data.system.disk_total_gb.toFixed(0)}GB SSD`;

                // Update charts
                if (data.history) {
                    updateCharts(data.history);
                }

                // Update model status display
                updateModelStatus(data.ollama);

            } catch (error) {
                console.error('Error fetching system data:', error);
                document.getElementById('last-updated').textContent = "⚠️ API Error";
                // Clear stats on error? Or leave old data? Leaving old data for now.
            }
        }

        // Update model status display
        function updateModelStatus(ollamaData) {
            const modelStatusDisplay = document.getElementById('model-status-display');

            if (ollamaData && ollamaData.base_model) {
                const baseModelAvailable = ollamaData.base_model.available;
                const customModelAvailable = ollamaData.custom_model && ollamaData.custom_model.available;

                let baseModelSize = "Unknown";
                if (ollamaData.base_model.size) {
                    baseModelSize = `${(ollamaData.base_model.size / (1024 * 1024 * 1024)).toFixed(2)} GB`;
                }

                let customModelSize = "Not created";
                if (ollamaData.custom_model && ollamaData.custom_model.size) {
                    customModelSize = `${(ollamaData.custom_model.size / (1024 * 1024 * 1024)).toFixed(2)} GB`;
                }

                let statusHtml = '';

                if (baseModelAvailable) {
                    statusHtml += `
                        <div class="p-3 bg-gray-700 rounded mb-3">
                            <div class="flex items-center">
                                <div class="status-indicator"></div>
                                <div class="text-white font-medium">${ollamaData.base_model.name}</div>
                                <span class="ml-auto text-green-400 text-xs">Available</span>
                            </div>
                            <div class="mt-2 text-xs text-gray-300">
                                Size: ${baseModelSize}
                            </div>
                        </div>
                    `;
                } else {
                    statusHtml += `
                        <div class="p-3 bg-gray-700 rounded mb-3">
                            <div class="flex items-center">
                                <div class="status-indicator danger"></div>
                                <div class="text-white font-medium">${ollamaData.base_model.name}</div>
                                <span class="ml-auto text-red-400 text-xs">Not Available</span>
                            </div>
                            <div class="mt-2 text-xs">
                                <button id="pull-base-model" class="px-2 py-1 bg-blue-600 text-white rounded">
                                    Pull Model
                                </button>
                            </div>
                        </div>
                    `;
                }

                if (customModelAvailable) {
                    statusHtml += `
                        <div class="p-3 bg-gray-700 rounded">
                            <div class="flex items-center">
                                <div class="status-indicator"></div>
                                <div class="text-white font-medium">${ollamaData.custom_model.name}</div>
                                <span class="ml-auto text-green-400 text-xs">Available</span>
                            </div>
                            <div class="mt-2 text-xs text-gray-300">
                                Size: ${customModelSize}
                            </div>
                        </div>
                    `;
                } else {
                    statusHtml += `
                        <div class="p-3 bg-gray-700 rounded">
                            <div class="flex items-center">
                                <div class="status-indicator warning"></div>
                                <div class="text-white font-medium">${ollamaData.custom_model ? ollamaData.custom_model.name : 'avocado-gemma3'}</div>
                                <span class="ml-auto text-yellow-400 text-xs">Not Created</span>
                            </div>
                            <div class="mt-2 text-xs">
                                <button id="create-custom-model" class="px-2 py-1 bg-blue-600 text-white rounded">
                                    Create Custom Model
                                </button>
                            </div>
                        </div>
                    `;
                }

                // Add a release VRAM button
                statusHtml += `
                    <div class="mt-3">
                        <button id="release-vram" class="w-full px-3 py-2 bg-purple-600 text-white text-sm rounded">
                            Release VRAM
                        </button>
                    </div>
                `;

                modelStatusDisplay.innerHTML = statusHtml;

                // Add event listeners to buttons
                if (!baseModelAvailable) {
                    document.getElementById('pull-base-model').addEventListener('click', pullBaseModel);
                }

                if (!customModelAvailable) {
                    document.getElementById('create-custom-model').addEventListener('click', createCustomModel);
                }

                document.getElementById('release-vram').addEventListener('click', releaseVRAM);
            } else {
                modelStatusDisplay.innerHTML = `
                    <div class="p-3 bg-gray-700 rounded">
                        <div class="flex items-center">
                            <div class="spinner mr-2"></div>
                            <div class="text-gray-300">Checking model status...</div>
                        </div>
                    </div>
                `;
            }
        }

        // Function to pull base model
        async function pullBaseModel() {
            try {
                const button = document.getElementById('pull-base-model');
                button.disabled = true;
                button.innerHTML = '<div class="spinner mr-2"></div> Pulling...';

                // Use the Gemma3 API endpoint
                const response = await fetch('https://api.terrydynamics.com/gemma/api/pull-model', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Failed to pull model');

                button.innerHTML = 'Model Pulled!';

                // Refresh data after a short delay
                setTimeout(fetchSystemData, 2000);
            } catch (error) {
                console.error('Error pulling model:', error);
                const button = document.getElementById('pull-base-model');
                button.innerHTML = 'Error - Try Again';
                button.disabled = false;
            }
        }

        // Function to create custom model
        async function createCustomModel() {
            try {
                const button = document.getElementById('create-custom-model');
                button.disabled = true;
                button.innerHTML = '<div class="spinner mr-2"></div> Creating...';

                // Use the Gemma3 API endpoint
                const response = await fetch('https://api.terrydynamics.com/gemma/api/create-model', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Failed to create model');

                button.innerHTML = 'Model Created!';

                // Refresh data after a short delay
                setTimeout(fetchSystemData, 2000);
            } catch (error) {
                console.error('Error creating model:', error);
                const button = document.getElementById('create-custom-model');
                button.innerHTML = 'Error - Try Again';
                button.disabled = false;
            }
        }

        // Function to release VRAM
        async function releaseVRAM() {
            try {
                const button = document.getElementById('release-vram');
                button.disabled = true;
                button.innerHTML = '<div class="spinner mr-2"></div> Releasing VRAM...';

                // Use the Gemma3 API endpoint
                const response = await fetch('https://api.terrydynamics.com/gemma/api/release-model', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) throw new Error('Failed to release VRAM');

                button.innerHTML = 'VRAM Released!';

                // Refresh data after a short delay
                setTimeout(() => {
                    button.innerHTML = 'Release VRAM';
                    button.disabled = false;
                    fetchSystemData();
                }, 2000);
            } catch (error) {
                console.error('Error releasing VRAM:', error);
                const button = document.getElementById('release-vram');
                button.innerHTML = 'Error - Try Again';
                button.disabled = false;
            }
        }

        // Update charts with new data
        function updateCharts(historyData) {
            if (!historyData) return;

            // Format timestamps
            const labels = historyData.timestamps.map(time => {
                const date = new Date(time);
                return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            });

            // Take the last 30 points for all charts
            const lastIndex = historyData.cpu.length - 1;
            const startIndex = Math.max(0, lastIndex - 29);

            // Update performance chart
            performanceChart.data.labels = labels.slice(startIndex);
            performanceChart.data.datasets[0].data = historyData.cpu.slice(startIndex);
            performanceChart.data.datasets[1].data = historyData.gpu_usage.slice(startIndex);
            performanceChart.update();

            // Convert percentage to MB values for GPU memory chart
            // Use the P40's nominal VRAM (approx 24GB = 24576 MB) for calculation
            const vramTotal = 24576;
            const vramData = historyData.gpu_memory.slice(startIndex).map(percent => (percent / 100) * vramTotal);

            // Update GPU memory chart
            gpuMemoryChart.data.labels = labels.slice(startIndex);
            gpuMemoryChart.data.datasets[0].data = vramData;
            gpuMemoryChart.update();
        }

        // Initialize and set up refresh
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            fetchSystemData();

            // Set up periodic refresh
            setInterval(fetchSystemData, 10000); // Refresh every 10 seconds
        });

        // REMOVED Image generation functionality and event listeners

    </script>
</body>
</html>